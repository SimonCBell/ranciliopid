<div id=table></div>

<script>

   var TimeTempVals = [];
   
   function updateTemp(jsonValue) {
      var keys = Object.keys(jsonValue);

      var date = new Date();
      console.log(date);
   
      const curTempKey = keys[0];
      var curTemp = Number(jsonValue[curTempKey]);
      console.log(curTemp);

      TimeTempVals.push([date ,curTemp]);
   }


   if (!!window.EventSource) {
      var source = new EventSource('/events');
   
      source.addEventListener(
         'new_status',
         function (e) {
            console.log("new_status", e.data);
            var myObj = JSON.parse(e.data);
            console.log(myObj);
            updateTemp(myObj);
            updateTable();
         }
      )
   }

   function updateTable() { 
      var s = '<table><tbody>';
      s += '<tr><th><b>Time</b></th><th><b>Temp</b></th></tr>';

      for (const element of TimeTempVals) {
         s = s +'<tr><td>' + element[0] + '</td>' + '<td>' + element[1] + '</td></tr>' ;
      }

      s += '</tbody></table>';

      document.getElementById("table").innerHTML = s 
   }

   const rows = [
       ["name1", "city1", "some other info"],
       ["name2", "city2", "more info"]
      ];

   let csvContent = "data:text/csv;charset=utf-8," 
       + rows.map(e => e.join(",")).join("\n");
    
   var encodedUri = encodeURI(csvContent);
   window.open(encodedUri);

</script>
